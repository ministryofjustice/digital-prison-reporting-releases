version: 2.1

orbs:
  reporting: ministryofjustice/hmpps-reporting@dev:fdc45f6213213a9255e34cc30f6a3345aae8d65e

parameters:
  project:
    type: string
    default: ""
  release_tag:
    type: string
    default: ""
  is_pr:
    type: boolean
    default: false
  tag:
    type: string
    default: "11.0"    
  is_release:
    type: string
    default: "release"   
  skip:
    description: if set to true will skip the workflow
    type: boolean
    default: false  
  terraform_pipeline:
    type: boolean
    default: false

workflows:
  release:
    when: # Skip if the Set to True
      not: <<pipeline.parameters.skip>> 
    jobs:
      - reporting/generic_release:
          sync_args: "--exclude '*' --include '*-all*jar'"
          release_ready: true
          build_args: "-x test"
          dry_run: false
          notify_slack: false
          terraform_pipeline: << pipeline.parameters.terraform_pipeline >>
         # executor: terraform
         # tag: << pipeline.parameters.tag >>
         # tag: "1.4.0-awscli-v1-0.1"
          executor: 
            name: 'reporting/terraform-aws'
            tag: '1.4.0-awscli-v1-0.3-wip-6'
          is_pr: << pipeline.parameters.is_pr >>
          pull_request: << pipeline.parameters.is_pr >>
          ref: << pipeline.git.branch >><< pipeline.git.tag >>
          is_rollback: false
          context:
            - hmpps-reporting-common
          filters:
            branches:
              only: /.*/
            tags:
              ignore: /.*/